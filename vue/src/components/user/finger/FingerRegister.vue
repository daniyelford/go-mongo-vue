<template>
   <div class="p-4">
    <b-button @click="register" variant="primary" class="d-flex align-items-center">
      <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0,0,256,256"><g fill="#010018" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><g transform="scale(2.56,2.56)"><path d="M24,17c-3.85433,0 -7,3.14567 -7,7v10c-0.0051,0.36064 0.18438,0.69608 0.49587,0.87789c0.3115,0.18181 0.69676,0.18181 1.00825,0c0.3115,-0.18181 0.50097,-0.51725 0.49587,-0.87789v-10c0,-2.77367 2.22633,-5 5,-5h10c0.36064,0.0051 0.69608,-0.18438 0.87789,-0.49587c0.18181,-0.3115 0.18181,-0.69676 0,-1.00825c-0.18181,-0.3115 -0.51725,-0.50097 -0.87789,-0.49587zM66,17c-0.36064,-0.0051 -0.69608,0.18438 -0.87789,0.49587c-0.18181,0.3115 -0.18181,0.69676 0,1.00825c0.18181,0.3115 0.51725,0.50097 0.87789,0.49587h10c2.77367,0 5,2.22633 5,5v10c-0.0051,0.36064 0.18438,0.69608 0.49587,0.87789c0.3115,0.18181 0.69676,0.18181 1.00825,0c0.3115,-0.18181 0.50097,-0.51725 0.49587,-0.87789v-10c0,-3.85433 -3.14567,-7 -7,-7zM48.94336,24.00781c-1.5155,0.02704 -3.0449,0.1983 -4.57031,0.52539c-6.396,1.36919 -11.88398,5.15462 -15.43945,10.64648c-3.5535,5.49197 -4.75601,12.0484 -3.38477,18.44141c1.07902,5.03679 3.98495,11.94951 9.23242,18.20117c0.17798,0.21142 0.49366,0.23853 0.70508,0.06055c0.21142,-0.17798 0.23853,-0.49366 0.06055,-0.70508c-5.13053,-6.11234 -7.98051,-12.90641 -9.02148,-17.76562c-1.31676,-6.13899 -0.16445,-12.41542 3.24805,-17.68945c3.41452,-5.27414 8.66659,-8.89612 14.80859,-10.21094c5.84633,-1.25362 11.75197,-0.12584 16.66602,2.72656c0.15456,0.09004 0.34542,0.09077 0.50067,0.00193c0.15525,-0.08885 0.2513,-0.25377 0.25197,-0.43265c0.00067,-0.17887 -0.09415,-0.34451 -0.24873,-0.43452c-3.83697,-2.2272 -8.26208,-3.44635 -12.80859,-3.36523zM48.50977,28.01758c-0.01174,0.00024 -0.02346,0.00089 -0.03516,0.00195c-1.08134,0.05427 -2.17123,0.18995 -3.26367,0.42383c-5.35091,1.14619 -9.94348,4.31331 -12.91797,8.9082c-2.97248,4.59495 -3.98124,10.08358 -2.83398,15.43164c1.19218,5.56213 4.84073,13.65083 11.83008,20.08398c0.12869,0.13486 0.32171,0.18694 0.50077,0.13512c0.17906,-0.05182 0.31443,-0.19893 0.35122,-0.38167c0.03678,-0.18274 -0.03113,-0.37077 -0.1762,-0.48783c-6.80865,-6.26689 -10.38152,-14.21467 -11.52734,-19.56055c-1.09274,-5.09394 -0.13816,-10.29873 2.69336,-14.67578c2.83351,-4.37711 7.19198,-7.38279 12.28906,-8.47461c1.03755,-0.22212 2.07481,-0.35257 3.10547,-0.4043c0.27606,-0.00442 0.4963,-0.23174 0.49199,-0.50781c-0.00431,-0.27607 -0.23155,-0.4964 -0.50762,-0.49219zM51.5,28.09375c-0.26856,-0.00317 -0.49166,0.20638 -0.5053,0.47461c-0.01365,0.26823 0.18703,0.49934 0.45452,0.52344c5.83006,0.59558 11.12196,3.82021 14.33789,8.68359c0.09524,0.15622 0.2682,0.24795 0.45096,0.23917c0.18276,-0.00878 0.34612,-0.11667 0.42595,-0.28131c0.07983,-0.16463 0.06336,-0.35972 -0.04292,-0.50865c-3.38207,-5.11462 -8.93837,-8.50053 -15.07031,-9.12695c-0.01685,-0.00216 -0.0338,-0.00347 -0.05078,-0.00391zM64.48828,29.34375c-0.21236,0.00275 -0.39982,0.13933 -0.46751,0.34064c-0.06769,0.2013 -0.00083,0.4234 0.16672,0.55389c3.07567,2.45642 5.56535,5.66837 7.09961,9.44922c0.06067,0.17437 0.21248,0.30113 0.39488,0.32971c0.1824,0.02858 0.3657,-0.04567 0.4768,-0.19313c0.11109,-0.14746 0.13189,-0.34414 0.05411,-0.51157c-1.60174,-3.94716 -4.19806,-7.29789 -7.40039,-9.85547c-0.09131,-0.07485 -0.20616,-0.11498 -0.32422,-0.11328zM49.34766,31.99023c-1.09002,0.0095 -2.19368,0.12864 -3.29883,0.36523c-4.30595,0.92219 -8.00495,3.47202 -10.39844,7.16992v0.00195c-1.17705,1.81918 -1.96643,3.81301 -2.35937,5.88086c-0.03814,0.17757 0.023,0.36185 0.15972,0.48141c0.13671,0.11956 0.3275,0.15559 0.49841,0.09413c0.1709,-0.06146 0.29504,-0.21075 0.3243,-0.39c0.36906,-1.94215 1.10985,-3.81261 2.2168,-5.52344c2.25251,-3.48009 5.71553,-5.86852 9.76758,-6.73633c8.31085,-1.77923 16.55227,3.5213 18.38281,11.81445v0.00391l0.00195,0.00195c0.0361,0.15425 0.09766,0.33073 0.17578,0.5293c0.1014,0.25727 0.39215,0.38362 0.64941,0.28223c0.25727,-0.1014 0.38362,-0.39215 0.28223,-0.64941c-0.06489,-0.16492 -0.12351,-0.34502 -0.13281,-0.38281l-0.00195,-0.00391v-0.00195c-1.70636,-7.71665 -8.6395,-13.00398 -16.26758,-12.9375zM49.38477,35.99219c-0.82558,0.007 -1.66311,0.09643 -2.5,0.27539c-3.26199,0.69818 -6.06348,2.63164 -7.875,5.43164c-1.81146,2.79991 -2.42776,6.14715 -1.72852,9.4082c1.51349,7.06398 8.08092,19.30695 22.63281,22.87891c0.17586,0.04957 0.36475,-0.00072 0.49268,-0.13117c0.12793,-0.13045 0.17453,-0.32028 0.12154,-0.49514c-0.05299,-0.17486 -0.19712,-0.3069 -0.37594,-0.34439c-14.10411,-3.46204 -20.45407,-15.40317 -21.89258,-22.11719c-0.64476,-3.00695 -0.0807,-6.07416 1.58984,-8.65625c1.67048,-2.582 4.23613,-4.35423 7.24414,-4.99805c6.16486,-1.3183 12.28212,2.61453 13.64063,8.76758v0.00195v0.00195c0.1363,0.58856 0.54864,1.83076 1.71094,2.93555c1.1623,1.10479 3.07035,2.03711 6.05859,2.03711h3c0.18032,0.00255 0.34804,-0.09219 0.43894,-0.24794c0.0909,-0.15575 0.0909,-0.34838 0,-0.50413c-0.0909,-0.15575 -0.25863,-0.25049 -0.43894,-0.24794h-3c-2.78375,0 -4.39589,-0.83671 -5.37109,-1.76367c-0.9733,-0.92515 -1.31545,-1.97182 -1.42187,-2.42969l-0.00195,-0.00391c-1.29269,-5.84524 -6.5466,-9.84795 -12.32422,-9.79883zM49.41992,39.99023c-0.56125,0.00478 -1.12872,0.06604 -1.69727,0.1875c-2.21678,0.47518 -4.12393,1.79036 -5.35547,3.69336c-1.23153,1.90298 -1.65103,4.1824 -1.17578,6.39844c0.80527,3.75757 3.25688,9.16076 7.9668,13.5293c0.13083,0.12179 0.3167,0.16452 0.48758,0.11209c0.17088,-0.05242 0.30081,-0.19203 0.34084,-0.36623c0.04003,-0.1742 -0.01592,-0.35652 -0.14678,-0.47828c-4.53409,-4.20546 -6.91119,-9.46543 -7.66992,-13.00586c-0.42075,-1.96196 -0.05336,-3.96147 1.03711,-5.64648c1.09013,-1.68448 2.76217,-2.83667 4.72461,-3.25781c4.01767,-0.85832 8.01104,1.70417 8.89648,5.7168v0.00195v0.00195c0.15832,0.68442 0.74234,2.69561 2.46875,4.56055c1.72641,1.86493 4.61211,3.55078 9.20703,3.55078h4c0.18032,0.00255 0.34804,-0.09219 0.43894,-0.24794c0.0909,-0.15575 0.0909,-0.34838 0,-0.50413c-0.0909,-0.15575 -0.25863,-0.25049 -0.43894,-0.24794h-4c-4.35408,0 -6.91702,-1.54595 -8.47461,-3.22852c-1.55482,-1.67957 -2.09073,-3.52447 -2.22461,-4.10156l-0.00195,-0.00586c-0.75388,-3.40432 -3.48871,-5.89131 -6.72656,-6.51172c-0.53997,-0.10346 -1.095,-0.15517 -1.65625,-0.15039zM67.8125,39.99414c-0.16703,0.00487 -0.32059,0.09286 -0.40926,0.23449c-0.08867,0.14164 -0.10073,0.3182 -0.03215,0.47058c0.27661,0.63364 0.52594,1.27731 0.73438,1.93945c0.08252,0.26374 0.36322,0.41064 0.62695,0.32813c0.26374,-0.08252 0.41064,-0.36322 0.32812,-0.62695c-0.22156,-0.70386 -0.48604,-1.3807 -0.77344,-2.03906c-0.07976,-0.19037 -0.26828,-0.31217 -0.47461,-0.30664zM49.46289,43.99023c-0.29731,0.0029 -0.59831,0.0351 -0.90039,0.09961h-0.00195c-2.42416,0.51962 -3.97667,2.91755 -3.45703,5.3418c0.64414,3.00529 2.53429,7.23758 6.12305,10.81445c3.58876,3.57687 8.89298,6.47368 16.26172,6.71875c0.18448,0.01628 0.36284,-0.07072 0.46358,-0.22612c0.10073,-0.1554 0.10733,-0.35375 0.01715,-0.5155c-0.09018,-0.16175 -0.26237,-0.26042 -0.44752,-0.25643c-7.12421,-0.23693 -12.1554,-3.00661 -15.58789,-6.42773c-3.43249,-3.42113 -5.2517,-7.5177 -5.85156,-10.31641c-0.40623,-1.89514 0.79271,-3.74907 2.6875,-4.15625c1.89132,-0.4039 3.73632,0.78444 4.15234,2.66797v0.00195v0.00391c0.22161,0.95885 1.8893,7.06055 8.38086,9.85742c0.16558,0.07984 0.36162,0.06239 0.5105,-0.04544c0.14888,-0.10783 0.22659,-0.28865 0.20237,-0.47087c-0.02422,-0.18222 -0.14646,-0.33647 -0.31834,-0.40166c-6.05606,-2.60924 -7.61458,-8.36439 -7.79883,-9.16016l-0.00195,-0.00586c-0.40092,-1.80314 -1.84252,-3.11803 -3.55664,-3.44531c-0.28602,-0.05461 -0.57964,-0.08102 -0.87695,-0.07812zM49.48828,47.98242c-0.14999,0.00431 -0.29012,0.07574 -0.38171,0.19459c-0.0916,0.11885 -0.12498,0.27255 -0.09094,0.41869c0,0 0.18558,0.84573 0.67383,2.08789c0.0615,0.17185 0.21175,0.29653 0.39199,0.3253c0.18024,0.02877 0.36184,-0.04296 0.47378,-0.18712c0.11194,-0.14417 0.13644,-0.33787 0.06392,-0.50536c-0.46375,-1.17983 -0.62695,-1.93359 -0.62695,-1.93359c-0.04835,-0.23819 -0.26096,-0.40712 -0.50391,-0.40039zM33.56055,48.99219c-0.14138,-0.00267 -0.27728,0.05464 -0.37405,0.15774c-0.09677,0.1031 -0.14537,0.24235 -0.13376,0.38328c0.05205,0.79608 0.14458,1.60253 0.31836,2.41211h-0.00195c0.76793,3.584 2.68589,8.32346 6.03711,12.85156c0.10519,0.14613 0.28082,0.22442 0.45982,0.20498c0.179,-0.01944 0.33373,-0.13361 0.4051,-0.29891c0.07137,-0.1653 0.04837,-0.35621 -0.06023,-0.49982c-3.26073,-4.4059 -5.12921,-9.04275 -5.86328,-12.46875c-0.16022,-0.74642 -0.24693,-1.50366 -0.29687,-2.26758c-0.01332,-0.26244 -0.2275,-0.46979 -0.49023,-0.47461zM51.60352,52.99414c-0.17638,0.00987 -0.33446,0.11207 -0.41586,0.26885c-0.0814,0.15678 -0.07403,0.34488 0.01937,0.49482c2.47847,4.11848 7.58908,9.23047 17.29688,9.23047c0.18032,0.00255 0.34804,-0.09219 0.43894,-0.24794c0.0909,-0.15575 0.0909,-0.34838 0,-0.50413c-0.0909,-0.15575 -0.25863,-0.25049 -0.43894,-0.24794c-9.3602,0 -14.08387,-4.82857 -16.44141,-8.74609c-0.09432,-0.16227 -0.27156,-0.25805 -0.45898,-0.24805zM65.47461,57.77148c-0.25699,0.01248 -0.46257,0.21794 -0.47519,0.47493c-0.01262,0.25699 0.17183,0.4816 0.42636,0.51921c0.65066,0.09647 1.33391,0.16449 2.05078,0.19727c0.18311,0.01663 0.36057,-0.06856 0.46211,-0.22184c0.10154,-0.15328 0.11078,-0.34991 0.02405,-0.51204c-0.08673,-0.16212 -0.25542,-0.26357 -0.43928,-0.26417c-0.68312,-0.03123 -1.33188,-0.09597 -1.94922,-0.1875c-0.03292,-0.00527 -0.06629,-0.00723 -0.09961,-0.00586zM70.5,57.98828c-0.18032,-0.00255 -0.34804,0.09219 -0.43894,0.24794c-0.0909,0.15575 -0.0909,0.34838 0,0.50413c0.0909,0.15575 0.25863,0.25049 0.43894,0.24794h1.00391c0.18032,0.00255 0.34804,-0.09219 0.43894,-0.24794c0.0909,-0.15575 0.0909,-0.34838 0,-0.50413c-0.0909,-0.15575 -0.25863,-0.25049 -0.43894,-0.24794zM17.98438,64.98633c-0.55152,0.00862 -0.99193,0.46214 -0.98437,1.01367v10c0,3.85433 3.14567,7 7,7h10c0.36064,0.0051 0.69608,-0.18438 0.87789,-0.49587c0.18181,-0.3115 0.18181,-0.69676 0,-1.00825c-0.18181,-0.3115 -0.51725,-0.50097 -0.87789,-0.49587h-10c-2.77367,0 -5,-2.22633 -5,-5v-10c0.0037,-0.2703 -0.10218,-0.53059 -0.29351,-0.72155c-0.19133,-0.19097 -0.45182,-0.29634 -0.72212,-0.29212zM81.98438,64.98633c-0.55152,0.00862 -0.99193,0.46214 -0.98437,1.01367v10c0,2.77367 -2.22633,5 -5,5h-10c-0.36064,-0.0051 -0.69608,0.18438 -0.87789,0.49587c-0.18181,0.3115 -0.18181,0.69676 0,1.00825c0.18181,0.3115 0.51725,0.50097 0.87789,0.49587h10c3.85433,0 7,-3.14567 7,-7v-10c0.0037,-0.2703 -0.10218,-0.53059 -0.29351,-0.72155c-0.19133,-0.19097 -0.45182,-0.29634 -0.72212,-0.29212zM52.5,65.32227c-0.22101,-0.00165 -0.41689,0.14198 -0.48177,0.35326c-0.06487,0.21128 0.01666,0.44009 0.20052,0.56275c3.68644,2.5171 8.39054,4.34244 14.25586,4.68555c0.18109,0.01534 0.35624,-0.06878 0.45748,-0.2197c0.10124,-0.15092 0.11263,-0.34489 0.02974,-0.50663c-0.08288,-0.16173 -0.24699,-0.26577 -0.42863,-0.27172c-5.69068,-0.33289 -10.2064,-2.09277 -13.75195,-4.51367c-0.08257,-0.05757 -0.18059,-0.08889 -0.28125,-0.08984zM42.26172,66.99609c-0.19412,0.01179 -0.3638,0.13505 -0.43501,0.31602c-0.07121,0.18097 -0.03105,0.38681 0.10298,0.52773c0.99174,1.07379 2.06872,2.11718 3.25,3.10547c0.13649,0.11983 0.32723,0.15623 0.49826,0.09508c0.17103,-0.06115 0.29545,-0.21023 0.32503,-0.38944c0.02957,-0.17921 -0.04035,-0.36036 -0.18266,-0.47322c-1.14472,-0.95771 -2.18999,-1.97137 -3.15625,-3.01758c-0.10211,-0.11314 -0.25024,-0.17354 -0.40234,-0.16406zM48.49219,72.29102c-0.2209,0.00176 -0.41447,0.14826 -0.47617,0.36037c-0.0617,0.21212 0.0231,0.43958 0.20859,0.55955c0.35452,0.23404 0.7144,0.48063 1.10352,0.7168c0.15299,0.09724 0.34664,0.10407 0.5061,0.01784c0.15946,-0.08623 0.25976,-0.25201 0.26214,-0.43328c0.00238,-0.18127 -0.09353,-0.34963 -0.25066,-0.44002c-0.35889,-0.21783 -0.70683,-0.45535 -1.07031,-0.69531c-0.08357,-0.05657 -0.18229,-0.08652 -0.2832,-0.08594z"></path></g></g></svg>
    </b-button>      
    <b-alert v-if="message" variant="success" class="mt-2">
      {{ message }}
    </b-alert>
  </div>
</template>
<script setup>
import { ref } from 'vue';
import { sendApi } from '@/plugins/api';
import { base64UrlToUint8Array,bufferToBase64Url } from '@/plugins/base64';
const message = ref("");
async function register() {
  try {
    const options = await sendApi({
        method: "POST",
        autoCheckToken: true,
        url: "/register/fingerPrint/start",
    });
    options.publicKey.challenge = base64UrlToUint8Array(options.publicKey.challenge)
    options.publicKey.user.id = base64UrlToUint8Array(options.publicKey.user.id)
    const credential = await navigator.credentials.create(options);
    const dataToSend = {
      id: credential.id,
      rawId: bufferToBase64Url(credential.rawId),
      type: credential.type,
      response: {
        clientDataJSON: bufferToBase64Url(credential.response.clientDataJSON),
        attestationObject: bufferToBase64Url(credential.response.attestationObject)
      }
    };
    const res = await sendApi({
        method: "POST",
        autoCheckToken: true,
        url: "/register/fingerPrint/end",
        data: dataToSend,
    });
    message.value = res.message || "success";
  } catch (e) {
    console.error(e);
    message.value = "error";
  }
}
</script>
